
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.4">
    
    
      
        <title>**Section 6 - Creating a production grade workflow** - WineDoc</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#section-6-creating-a-production-grade-workflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="WineDoc" class="md-header-nav__button md-logo" aria-label="WineDoc">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            WineDoc
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              **Section 6 - Creating a production grade workflow**
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="WineDoc" class="md-nav__button md-logo" aria-label="WineDoc">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    WineDoc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="../../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      



  
    
  
  <li class="md-nav__item md-nav__item--section md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    
    <label class="md-nav__link" for="nav-2">
      Mkdocs
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Mkdocs" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Mkdocs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../mkdocs/mkdocs-getting-started-with-docker/" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
    
  
  <li class="md-nav__item md-nav__item--section md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    
    <label class="md-nav__link" for="nav-3">
      Udemy
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Udemy" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Udemy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" >
    
    <label class="md-nav__link" for="nav-3-1">
      Linux
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Linux" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        <span class="md-nav__icon md-icon"></span>
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../linux/cap03-system-access-and-file-system/" class="md-nav__link">
      Section 03
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../linux/cap04-linux-fundamentals/" class="md-nav__link">
      Section 04
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../linux/cap05-system-administration/" class="md-nav__link">
      Section 05
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../linux/cap06-shell-scripting/" class="md-nav__link">
      Section 06
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2" >
    
    <label class="md-nav__link" for="nav-3-2">
      Docker
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Docker" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        <span class="md-nav__icon md-icon"></span>
        Docker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../cap01-dive-into-docker/" class="md-nav__link">
      Section 01
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../cap02-manipulating-containers/" class="md-nav__link">
      Section 02
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../cap03-building-custom-images/" class="md-nav__link">
      Section 03
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../cap04-making-real-projects/" class="md-nav__link">
      Section 04
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../cap05-docker-compose/" class="md-nav__link">
      Section 05
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="./" class="md-nav__link">
      Section 06
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../cap07-continuous-integration-and-deployment/" class="md-nav__link">
      Section 07
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../cap08-cap09-building-multi-container-app-and-dockerizing-it/" class="md-nav__link">
      Sections 08 and 09
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../cap10-continuous-integration-for-multiple-images/" class="md-nav__link">
      Section 10
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    Development
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="section-6-creating-a-production-grade-workflow"><strong>Section 6 - Creating a production grade workflow</strong></h1>
<p>In a professional workflow, there usually exist two dockerfiles, one for development purposes and the other for production ones.
Why? Because, in general, when an application is being developed, everything happens inside a development environment. This environment allows the developer to make code changes, test them, and see their effects in real-time. So, no build process is needed to check if the changes have worked well or not.</p>
<hr />

<h2 id="development"><strong>Development</strong></h2>
<hr/>

<p>To start a development environment in a Nodejs application, one should run the following command:</p>
<pre><code>&gt;&gt; npm run start
</code></pre>
<p>In the code block bellow, you can see an example of a dockerfile that can be used to start a development environment.</p>
<p><strong>Dockerfile.dev</strong></p>
<pre><code class="language-Dockerfile">FROM node:alpine

WORKDIR /usr/app

COPY ./package.json ./
RUN npm install

COPY ./ ./

CMD [&quot;npm&quot;,&quot;run&quot;,&quot;start&quot;]

</code></pre>
<p><strong>WARNING !!</strong> </p>
<p>With the dockerfile above, one can build an image and create a container with a development environment running in its inside.</p>
<p>The problem is the following: the container's filesystem was created and filled with all application files in the state they were at the exact moment in which the build command was executed.</p>
<p>Once the container is running, you may want to make changes in the code and see its effects on the application. The only problem is that the files you are changing now are not the same as those that have been placed inside the container (during the build process).</p>
<p>Docker provides a way of mounting a filesystem of your local machine into the container. That way, every change in the files inside the container will be reflected outside of it and vice-versa. This feature is called <strong>Docker Volumes</strong>.</p>
<p>In the code block below, you can see an example of it.</p>
<p><strong>docker-compose.yml</strong></p>
<pre><code class="language-YML"># Docker-compose version
version: '3'

# Begin services array
services:
    web:
        build: 
            context: .
            dockerfile: ./Dockerfile.dev
        ports: &quot;3000:3000&quot;
        volumes:
          - /app/node_modules
          - .:./app

</code></pre>
<p>Two volumes are being declared for the container.</p>
<pre><code class="language-YML">    - /app/node_modules
    - .:./app
</code></pre>
<p>The second one is exactly what we have discussed in the previous paragraph. The current path (or context) is being mounted inside the container (in the path ./app, to be precise). So, the content in the context must match exactly the content inside the container. Therefore, files inside the container that does not exist in the context will be deleted, <strong>unless they are bookmarked</strong>, which is exactly what the first volume declaration does! </p>
<p>During the build process, dependencies have been installed in the image file system. For a Nodejs application, these dependencies are stored in a folder called node_modules. When you deploy a container using the image and mount your local file system inside the container, the docker server will notice that there is a folder called node_modules inside the container that does not match any folder in the context! To avoid it from being deleted, we transform it into a volume for the container.</p>
<hr />

<h2 id="testing"><strong>Testing</strong></h2>
<hr/>

<p>After the changes have been made, it is time to test the app!. <br/>
There are three different approaches to this situation, each one with its pros and cons.</p>
<p><br/></p>
<p><strong>First:</strong>: </p>
<p>If you have an image with an application installed within it and you just want to check if the tests are all passing with no failures, so you can just run the command:</p>
<pre><code>&gt;&gt; docker run -it imageName npm run test
</code></pre>
<p>With this approach, you won't be able to modify the application code, neither the tests suite.</p>
<p><br/></p>
<p><strong>Second</strong>:</p>
<p>If you have a docker-compose file like the one presented in the Development section of this README, you can first deploy the container in your machine and run the docker exec command to start the tests suit..</p>
<pre><code>&gt;&gt; docker-compose up
&gt;&gt; docker exec -it containerID npm run test
</code></pre>
<p>This approach is pretty handy. The downside of it is that you will have to type the command docker exec whenever you want to run the tests.</p>
<p><br/></p>
<p><strong>Third</strong>:</p>
<p>With this approach, the idea is to create a new service in the docker-compose file responsible for testing the app. It would look like as presented below:</p>
<pre><code class="language-YML">    tests:
        build:
            context: .
            dockerfile: ./Dockerfile.dev
        volumes:
            - /app/node_modules
            - .:./app  
        command: [&quot;npm&quot;,&quot;run&quot;,&quot;test&quot;] 
</code></pre>
<p>Now, you can just run docker-compose up to run the tests.
There is only one downside to this approach: if the testing framework has some interactive menu to allow the dev to customize the tests suite, it will not be possible to interact with it. The reason is that the process responsible for listening to these inputs (the testing framework) is not the main process running inside the container (which is the npm process), so it is not possible to attach or to execute commands via CLI in a process other than the one which corresponds to the PID 0.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../../../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: ['navigation.sections'],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>